#!/bin/bash
set -e

echo "Updating package index..."
sudo apt-get update -y

echo "Installing prerequisites: curl, unzip, gnupg, apt-transport-https, lsb-release, software-properties-common..."
sudo apt-get install -y curl unzip gnupg apt-transport-https lsb-release software-properties-common

# Install AWS CLI v2
echo "Downloading and installing AWS CLI v2..."
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
rm -rf awscliv2.zip aws

echo "AWS CLI version:"
aws --version

# Install kubectl
echo "Adding Kubernetes apt repository..."
curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo gpg --dearmor -o /usr/share/keyrings/kubernetes-archive-keyring.gpg

echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | \
  sudo tee /etc/apt/sources.list.d/kubernetes.list

sudo apt-get update -y
echo "Installing kubectl..."
sudo apt-get install -y kubectl

echo "kubectl version:"
kubectl version --client --short

# Install Helm
echo "Adding Helm apt repository..."
curl https://baltocdn.com/helm/signing.asc | sudo gpg --dearmor -o /usr/share/keyrings/helm.gpg
echo "deb [signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | \
  sudo tee /etc/apt/sources.list.d/helm-stable-debian.list

sudo apt-get update -y
echo "Installing Helm..."
sudo apt-get install -y helm

echo "Helm version:"
helm version --short

echo "All tools installed successfully!"
